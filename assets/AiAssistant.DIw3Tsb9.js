var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,r=(e,t)=>{for(var l in t||(t={}))o.call(t,l)&&s(e,l,t[l]);if(a)for(var l of a(t))n.call(t,l)&&s(e,l,t[l]);return e},u=(e,a)=>t(e,l(a)),i=(e,t,l)=>new Promise((a,o)=>{var n=e=>{try{r(l.next(e))}catch(t){o(t)}},s=e=>{try{r(l.throw(e))}catch(t){o(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,s);r((l=l.apply(e,t)).next())});import{L as c,d,C as v,o as f,c as m,i as p,m as y,n as h,w,M as b,f as $,r as _,N as k,O as C,x as g,P as x,Q as S,R as A,T as j,U as z,V as I,W as O,a as T,u as D,D as H,k as P,b as E,e as N,S as V,F as B,l as L,I as M,t as R,H as W,X as G,q}from"./index-Bn969S2Q.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";class F{constructor(e){this._reject=null,this.promise=new Promise((t,l)=>{e(t,l),this._reject=l})}abort(e){this._reject&&this._reject(e)}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}}function J(e){return"[object Object]"===Object.prototype.toString.call(e)||"object"==typeof e}function Q(e){const t=Object.prototype.toString.call(e).match(/\[object (\w+)\]/);return t&&t.length?t[1].toLowerCase():""}const X=e=>null!=e;function Z(e){return"function"===Q(e)||"asyncfunction"===Q(e)}function K(e){return!(!J(e)||!X(e))&&(Z(e.then)&&Z(e.catch))}function Y(e){if(t=e,"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)){const t=e.filter(function(e){return null!=e&&""!==e}).map(function(e){return Y(e)}).join(";");return t?t.endsWith(";")?t:t+";":""}var t;if(function(e){return"string"===Q(e)}(e))return e?e.endsWith(";")?e:e+";":"";if(J(e)){const t=Object.keys(e).filter(function(t){return null!=e[t]&&""!==e[t]}).map(function(t){return[(l=t,l.replace(/[A-Z]/g,function(e){return"-"+e}).toLowerCase()),e[t]].join(":");var l}).join(";");return t?t.endsWith(";")?t:t+";":""}return""}const ee=(e=1e3/30)=>new F(t=>{const l=setTimeout(()=>{clearTimeout(l),t(!0)},e)});const te=[Number,String],le=e=>({type:Boolean,default:e}),ae=e=>({type:Number,default:e}),oe=e=>({type:String,default:e}),ne={customStyle:oe(""),customClass:oe("")},se=u(r({},ne),{name:(re=String,{type:re,required:!0}),color:String,size:te,classPrefix:oe("wd-icon")});var re;const ue=U(d(u(r({},{name:"wd-icon",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:se,emits:["click","touch"],setup(e,{emit:t}){const l=e,a=t,o=v(()=>X(l.name)&&l.name.includes("/")),n=v(()=>{const e=l.classPrefix;return`${e} ${l.customClass} ${o.value?"wd-icon--image":e+"-"+l.name}`}),s=v(()=>{const e={};var t;return l.color&&(e.color=l.color),l.size&&(e["font-size"]=(t=l.size,Number.isNaN(Number(t))?`${t}`:`${t}px`)),`${Y(e)} ${l.customStyle}`});function r(e){a("click",e)}return(e,t)=>{const l=b,a=p;return f(),m(a,{onClick:r,class:h(n.value),style:y(s.value)},{default:w(()=>[o.value?(f(),m(l,{key:0,class:"wd-icon__image",src:e.name},null,8,["src"])):$("",!0)]),_:1},8,["class","style"])}}})),[["__scopeId","data-v-bef80b7c"]]),ie=u(r({},ne),{show:le(!1),duration:{type:[Object,Number,Boolean],default:300},lazyRender:le(!1),name:[String,Array],destroy:le(!0),enterClass:oe(""),enterActiveClass:oe(""),enterToClass:oe(""),leaveClass:oe(""),leaveActiveClass:oe(""),leaveToClass:oe(""),disableTouchMove:le(!1)}),ce=U(d(u(r({},{name:"wd-transition",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:ie,emits:["click","before-enter","enter","before-leave","leave","after-leave","after-enter"],setup(e,{emit:t}){const l=e=>{let t=`${a.enterClass} ${a.enterActiveClass}`,l=`${a.enterToClass} ${a.enterActiveClass}`,o=`${a.leaveClass} ${a.leaveActiveClass}`,n=`${a.leaveToClass} ${a.leaveActiveClass}`;if(Array.isArray(e))for(let a=0;a<e.length;a++)t=`wd-${e[a]}-enter wd-${e[a]}-enter-active ${t}`,l=`wd-${e[a]}-enter-to wd-${e[a]}-enter-active ${l}`,o=`wd-${e[a]}-leave wd-${e[a]}-leave-active ${o}`,n=`wd-${e[a]}-leave-to wd-${e[a]}-leave-active ${n}`;else e&&(t=`wd-${e}-enter wd-${e}-enter-active ${t}`,l=`wd-${e}-enter-to wd-${e}-enter-active ${l}`,o=`wd-${e}-leave wd-${e}-leave-active ${o}`,n=`wd-${e}-leave-to wd-${e}-leave-active ${n}`);return{enter:t,"enter-to":l,leave:o,"leave-to":n}},a=e,o=t,n=_(!1),s=_(!1),r=_(""),u=_(!1),c=_(300),d=_(""),b=_(null),S=_(null),A=_(null),j=v(()=>`-webkit-transition-duration:${c.value}ms;transition-duration:${c.value}ms;${s.value||!a.destroy?"":"display: none;"}${a.customStyle}`),z=v(()=>`wd-transition ${a.customClass}  ${d.value}`),I=v(()=>!a.lazyRender||n.value);function O(){o("click")}function T(){b.value=new F(e=>i(this,null,function*(){try{const t=l(a.name),i=J(a.duration)?a.duration.enter:a.duration;r.value="enter",o("before-enter"),S.value=ee(),yield S.value,o("enter"),d.value=t.enter,c.value=i,S.value=ee(),yield S.value,n.value=!0,s.value=!0,S.value=ee(),yield S.value,S.value=null,u.value=!1,d.value=t["enter-to"],e()}catch(t){}}))}function D(){u.value||(u.value=!0,"leave"===r.value?o("after-leave"):"enter"===r.value&&o("after-enter"),!a.show&&s.value&&(s.value=!1))}function H(){}return k(()=>{a.show&&T()}),C(()=>a.show,e=>{e?(K(b.value)&&b.value.abort(),K(S.value)&&S.value.abort(),K(A.value)&&A.value.abort(),b.value=null,S.value=null,A.value=null,T()):function(){i(this,null,function*(){if(!b.value)return u.value=!1,D();try{if(yield b.value,!s.value)return;const e=l(a.name),t=J(a.duration)?a.duration.leave:a.duration;r.value="leave",o("before-leave"),c.value=t,A.value=ee(),yield A.value,o("leave"),d.value=e.leave,A.value=ee(),yield A.value,u.value=!1,d.value=e["leave-to"],A.value=function(e){return new F(t=>{const l=setTimeout(()=>{clearTimeout(l),t()},e)})}(c.value),yield A.value,A.value=null,D(),b.value=null}catch(e){}})}()},{deep:!0}),(e,t)=>{const l=p;return I.value&&e.disableTouchMove?(f(),m(l,{key:0,class:h(z.value),style:y(j.value),onTransitionend:D,onClick:O,onTouchmove:g(H,["stop","prevent"])},{default:w(()=>[x(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])):I.value&&!e.disableTouchMove?(f(),m(l,{key:1,class:h(z.value),style:y(j.value),onTransitionend:D,onClick:O},{default:w(()=>[x(e.$slots,"default",{},void 0,!0)]),_:3},8,["class","style"])):$("",!0)}}})),[["__scopeId","data-v-60fd6c07"]]),de=u(r({},ne),{show:le(!1),duration:{type:[Object,Number,Boolean],default:300},lockScroll:le(!0),zIndex:ae(10)});const ve=U(d(u(r({},{name:"wd-overlay",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:de,emits:["click"],setup(e,{emit:t}){const l=e,a=t;function o(){a("click")}return function(e){const t=_(0),l=()=>{0===t.value&&(document.getElementsByTagName("body")[0].style.overflow="hidden"),t.value++},a=()=>{t.value>0&&(t.value--,0===t.value&&(document.getElementsByTagName("body")[0].style.overflow=""))},o=()=>{e()&&a()};C(e,e=>{e?l():a()}),S(o),A(o)}(()=>l.show&&l.lockScroll),(e,t)=>(f(),m(ce,{show:e.show,name:"fade","custom-class":"wd-overlay",duration:e.duration,"custom-style":`z-index: ${e.zIndex}; ${e.customStyle}`,"disable-touch-move":e.lockScroll,onClick:o},{default:w(()=>[x(e.$slots,"default",{},void 0,!0)]),_:3},8,["show","duration","custom-style","disable-touch-move"]))}})),[["__scopeId","data-v-43633df7"]]);const fe=Symbol("wd-config-provider"),me=d(u(r({},{name:"wd-root-portal",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{setup(e){const t=Symbol("None"),l=j("__CONFIG_PROVIDER__",t),{parent:a}=function(e){const t=j(e,null);if(t){const e=I(),{link:l,unlink:a,internalChildren:o}=t;return l(e),z(()=>a(e)),{parent:t,index:v(()=>o.indexOf(e))}}return{parent:null,index:_(-1)}}(fe),o=v(()=>l!==t?l.themeStyle.value||"":(null==a?void 0:a.themeStyle.value)||"");return(e,t)=>{const l=p;return f(),m(O,{to:"body"},[T(l,{style:y(o.value)},{default:w(()=>[x(e.$slots,"default")]),_:3},8,["style"])])}}})),pe=u(r({},ne),{transition:String,closable:le(!1),position:oe("center"),closeOnClickModal:le(!0),duration:{type:[Number,Boolean],default:300},modal:le(!0),zIndex:ae(10),hideWhenClose:le(!0),modalStyle:oe(""),safeAreaInsetBottom:le(!1),modelValue:le(!1),lazyRender:le(!0),lockScroll:le(!0),rootPortal:le(!1)}),ye=U(d(u(r({},{name:"wd-popup",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:pe,emits:["update:modelValue","before-enter","enter","before-leave","leave","after-leave","after-enter","click-modal","close"],setup(e,{emit:t}){const l=e,a=t,o=v(()=>l.transition?l.transition:"center"===l.position?["zoom-in","fade"]:"left"===l.position?"slide-left":"right"===l.position?"slide-right":"bottom"===l.position?"slide-up":"top"===l.position?"slide-down":"slide-up"),n=_(0),s=v(()=>`z-index:${l.zIndex}; padding-bottom: ${n.value}px;${l.customStyle}`),r=v(()=>`wd-popup wd-popup--${l.position} ${l.transition||"center"!==l.position?"":"is-deep"} ${l.customClass||""}`);function u(){a("click-modal"),l.closeOnClickModal&&i()}function i(){a("close"),a("update:modelValue",!1)}function d(){}return k(()=>{if(l.safeAreaInsetBottom){const{safeArea:e,screenHeight:t,safeAreaInsets:l}=function(){let e;return e=c(),e}();n.value=e&&l?l.bottom:0}}),(e,t)=>{const l=p;return e.rootPortal?(f(),m(me,{key:0},{default:w(()=>[T(l,{class:"wd-popup-wrapper"},{default:w(()=>[e.modal?(f(),m(ve,{key:0,show:e.modelValue,"z-index":e.zIndex,"lock-scroll":e.lockScroll,duration:e.duration,"custom-style":e.modalStyle,onClick:u,onTouchmove:d},null,8,["show","z-index","lock-scroll","duration","custom-style"])):$("",!0),T(ce,{"lazy-render":e.lazyRender,"custom-class":r.value,"custom-style":s.value,duration:e.duration,show:e.modelValue,name:o.value,destroy:e.hideWhenClose,onBeforeEnter:t[0]||(t[0]=e=>a("before-enter")),onEnter:t[1]||(t[1]=e=>a("enter")),onAfterEnter:t[2]||(t[2]=e=>a("after-enter")),onBeforeLeave:t[3]||(t[3]=e=>a("before-leave")),onLeave:t[4]||(t[4]=e=>a("leave")),onAfterLeave:t[5]||(t[5]=e=>a("after-leave"))},{default:w(()=>[x(e.$slots,"default",{},void 0,!0),e.closable?(f(),m(ue,{key:0,"custom-class":"wd-popup__close",name:"add",onClick:i})):$("",!0)]),_:3},8,["lazy-render","custom-class","custom-style","duration","show","name","destroy"])]),_:3})]),_:3})):(f(),m(l,{key:1,class:"wd-popup-wrapper"},{default:w(()=>[e.modal?(f(),m(ve,{key:0,show:e.modelValue,"z-index":e.zIndex,"lock-scroll":e.lockScroll,duration:e.duration,"custom-style":e.modalStyle,onClick:u,onTouchmove:d},null,8,["show","z-index","lock-scroll","duration","custom-style"])):$("",!0),T(ce,{"lazy-render":e.lazyRender,"custom-class":r.value,"custom-style":s.value,duration:e.duration,show:e.modelValue,name:o.value,destroy:e.hideWhenClose,onBeforeEnter:t[6]||(t[6]=e=>a("before-enter")),onEnter:t[7]||(t[7]=e=>a("enter")),onAfterEnter:t[8]||(t[8]=e=>a("after-enter")),onBeforeLeave:t[9]||(t[9]=e=>a("before-leave")),onLeave:t[10]||(t[10]=e=>a("leave")),onAfterLeave:t[11]||(t[11]=e=>a("after-leave"))},{default:w(()=>[x(e.$slots,"default",{},void 0,!0),e.closable?(f(),m(ue,{key:0,"custom-class":"wd-popup__close",name:"add",onClick:i})):$("",!0)]),_:3},8,["lazy-render","custom-class","custom-style","duration","show","name","destroy"])]),_:3}))}}})),[["__scopeId","data-v-f2ad800a"]]),he="https://api.deepseek.com/chat/completions",we="sk-792891d2f7194ba1a9f6f36ee3084310",be=U(d({__name:"AiAssistant",props:{show:r({type:Boolean},{default:!1}),showModifiers:{}},emits:["update:show"],setup(e){const t=D(),l=H(e,"show"),a=_([]),o=_(""),n=_(!1),s=_("anchor-init"),r=["您好！今天想处理什么表格问题？","您好，我可以帮您定位上传和处理失败原因。","您好，有什么问题可以直接告诉我。"],u=["为什么上传后处理失败？","手机端如何选择本地Excel？","支持哪些Excel格式？","处理完成后怎么下载？"];function c(){if(l.value=!0,a.value.length>0)return;const e=r[Math.floor(Math.random()*r.length)]||"您好";a.value.push({id:"welcome_"+Date.now(),role:"assistant",content:`${t.userHonorific}，${e}`,timestamp:Date.now()})}function d(){l.value=!1}function v(e){return i(this,null,function*(){const l=(e||o.value).trim();if(l&&!n.value){a.value.push({id:"u_"+Date.now(),role:"user",content:l,timestamp:Date.now()}),o.value="",a.value.push({id:"l_"+Date.now(),role:"assistant",content:"",timestamp:Date.now(),loading:!0}),n.value=!0,b();try{const e=yield function(e){return i(this,null,function*(){var l,o,n,s;const r=a.value.filter(e=>!e.loading).slice(-8).map(e=>({role:e.role,content:e.content})),u={role:"system",content:`你是一个Excel移动端助手。用户称呼是“${t.userHonorific}”。回答要简洁、步骤化、可执行。`};try{const t=yield new Promise((t,l)=>{W({url:he,method:"POST",timeout:2e4,header:{"Content-Type":"application/json",Authorization:`Bearer ${we}`},data:{model:"deepseek-chat",messages:[u,...r,{role:"user",content:e}],temperature:.5,max_tokens:1024},success:t,fail:l})}),a="string"==typeof t.data?JSON.parse(t.data):t.data,i=null==(n=null==(o=null==(l=null==a?void 0:a.choices)?void 0:l[0])?void 0:o.message)?void 0:n.content;if(200===t.statusCode&&i)return i;throw new Error((null==(s=null==a?void 0:a.error)?void 0:s.message)||(null==a?void 0:a.message)||"AI返回为空")}catch(i){return console.error("DeepSeek 请求失败:",i),y(e)}})}(l);a.value=a.value.filter(e=>!e.loading),a.value.push({id:"a_"+Date.now(),role:"assistant",content:e,timestamp:Date.now()})}catch(s){a.value=a.value.filter(e=>!e.loading),a.value.push({id:"e_"+Date.now(),role:"assistant",content:`${t.userHonorific}，AI请求失败，已切换本地答复：\n${y(l)}`,timestamp:Date.now()})}finally{n.value=!1,b()}}})}function y(e){const l=e.toLowerCase();return l.includes("上传")||l.includes("选择")?`${t.userHonorific}，请按这3步操作：\n1. 点击“选择文件”\n2. 选择 .xlsx/.xls\n3. 点击“开始处理”`:l.includes("失败")||l.includes("报错")?`${t.userHonorific}，请先检查：\n1. 文件是否为 .xlsx/.xls\n2. 表头是否包含“会计月”\n3. 文件是否被其它App占用`:l.includes("下载")?`${t.userHonorific}，处理完成后点“下载”即可。小程序里会直接打开文档。`:l.includes("格式")||l.includes("支持")?`${t.userHonorific}，目前支持 .xlsx 和 .xls，推荐 .xlsx。`:`${t.userHonorific}，我可以帮您定位上传失败、处理失败、下载失败。请把具体报错发给我。`}function b(){G(()=>{s.value="anchor-"+Date.now()})}function k(){q({title:"提示",content:"确定清空聊天记录吗？",confirmColor:"#3C6E84",success:e=>{e.confirm&&(a.value=[],c())}})}function C(e){const t=new Date(e);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}return(e,t)=>{const r=E,i=p,y=V,b=M,_=ye;return f(),P(B,null,[T(i,{class:"ai-float-btn",onClick:c},{default:w(()=>[T(i,{class:"float-inner"},{default:w(()=>[T(r,{class:"emoji"},{default:w(()=>[N("AI")]),_:1})]),_:1})]),_:1}),T(_,{modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value=e),position:"bottom","custom-style":"height: 86vh; border-radius: 28rpx 28rpx 0 0;","safe-area-inset-bottom":!0},{default:w(()=>[T(i,{class:"chat-wrap"},{default:w(()=>[T(i,{class:"chat-header"},{default:w(()=>[T(r,{class:"title"},{default:w(()=>[N("智能助手")]),_:1}),T(i,{class:"header-actions"},{default:w(()=>[T(i,{class:"icon-btn",onClick:k},{default:w(()=>[N("清空")]),_:1}),T(i,{class:"icon-btn",onClick:d},{default:w(()=>[N("关闭")]),_:1})]),_:1})]),_:1}),T(y,{class:"chat-content","scroll-y":"","scroll-into-view":s.value,"scroll-with-animation":""},{default:w(()=>[(f(!0),P(B,null,L(a.value,e=>(f(),m(i,{key:e.id,class:h(["msg-row",e.role])},{default:w(()=>[T(i,{class:"msg-box"},{default:w(()=>[e.loading?(f(),m(i,{key:0,class:"loading"},{default:w(()=>[N("思考中...")]),_:1})):(f(),m(r,{key:1,class:"msg-text"},{default:w(()=>[N(R(e.content),1)]),_:2},1024)),T(r,{class:"msg-time"},{default:w(()=>[N(R(C(e.timestamp)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128)),a.value.length<=1?(f(),m(i,{key:0,class:"quick-wrap"},{default:w(()=>[(f(),P(B,null,L(u,e=>T(i,{key:e,class:"quick-item",onClick:t=>v(e)},{default:w(()=>[T(r,null,{default:w(()=>[N(R(e),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})):$("",!0),T(i,{id:s.value,class:"anchor"},null,8,["id"])]),_:1},8,["scroll-into-view"]),T(i,{class:"chat-input"},{default:w(()=>[T(b,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),class:"input",placeholder:"输入问题后发送","confirm-type":"send",disabled:n.value,onConfirm:t[1]||(t[1]=e=>v())},null,8,["modelValue","disabled"]),T(i,{class:h(["send-btn",{active:o.value.trim()&&!n.value}]),onClick:t[2]||(t[2]=e=>v())},{default:w(()=>[T(r,null,{default:w(()=>[N(R(n.value?"...":"发送"),1)]),_:1})]),_:1},8,["class"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-906499be"]]);export{be as A,ye as _};
